# C3D model

我们有3个发现：

- 比起2D卷积网络，3D卷积网络更适合学习时空特征。
- 所有层都使用相同的3x3x3的小卷积核结构，3D卷积网络性能达到最佳。
- 我们的学习特征加上简单的线性分类器在4个不同的基准测试中优于最先进的方法，并且在其他2个基准测试中可与目前最佳方法相比较。

有效的视频描述有四个属性：通用、紧密、有效、简单

在本文中我们的贡献是：

通过实验，我们得出3D卷积深度网络是一个好的特征学习器，能够同时模拟物体的外观和运动。

通过实验，我们发现所有层使用3x3x3卷积核，在有限的已知结构中性能最好。

通过一个简单的线性模型来提取特征超过当前4个基准测试最好的方法或者接近6个基准测试最好的方法。

在所有前人的方法中，3D卷积网络与我们的工作最接近。他们利用了人体检测器和头部跟踪的方法分割出视频中人的主体。分割出来的视频块作为3个卷积层的3D卷积网络分类行为的输入。

作为对比，我们的方法将全部视频帧作为输入并且不依赖任何预处理，因此很容易扩展到大型数据集上。在网络的所有层中，我们的模型进行3D卷积和3D池化操作来传播时间信息。通过实验，我们发现池化空间和时间信息、构建更深的网络可以实现更好的结果。

3D卷积网络学习特征

3D卷积和池化

![2d3dconv](C:\Users\18292\Desktop\2d3dconv.png)

2D与3D卷积之间的区别。a)和b)分别为2D卷积用于单通道图像和多通道图像的情况(此处多通道图像可以指同一张图片的3个颜色通道，也指多张堆叠在一起的图片，即一小段视频)，对于一个滤波器，输出为一张二维的特征图，多通道的信息被完全压缩了。而c)中的3D卷积的输出仍然为3D的特征图。

现在考虑一个视频段输入，其大小为cxlxhxw，其中c为图像通道(一般为3)，l为视频序列的长度，h和w分别为视频的宽与高。进行一次kernel size为3*3*3，stride为1，padding=True，滤波器个数为k的3D卷积后，输出的大小为kxlxhxw。池化同理。

我将空间感受野固定为3x3并且只改变3D卷积核的时间深度来对我们的结构探索研究。

符号：

为了简单起见，我们将视频片段的尺寸设定为cxlxhxw，其中，c是通道数，l是帧数，h和w是每一帧的长和宽。我们还将3D卷积核和池化核尺寸设定为dxkxk，其中，d是核的深度，k是核的空间尺寸。

通用网络的设置：

这个网络将视频片段作为输入，预测出类别标签属于101不同行为的哪一类。所有视频帧resize为128x171。这大概是UCF101帧的一半分辨率。视频被分成不重叠的16帧片段，每个片段作为网络的输入。输入维度为3x16x128x171。训练期间，我们使用随机抖动将视频片段切割成3x16x112x112的输入片段。网络有5个卷积层和5个池化层(每个卷积层后面紧跟着一个池化层)，2个全连接层和一个softmax损失层来预测行为标签。5个卷积层的卷积核数量从前往后分别为64，128，256，256，256。所有卷积核都有时间深度d(我们将改变d的值来探究最好的3D结构)。所有卷积层都使用padding(包括空间和时间)填充且步长为1，因此每个卷积层的输入到输出的尺寸没有改变。所有池化层为最大池化，核的尺寸为2x2x2(除了第一层)且步长为1，这意味这池化层的输出尺寸为输入尺寸的1/8，第一个池化层的核尺寸为1x2x2，为了不过早的融合时间信息同时满足了16帧长度的片段(例如，在时间上池化因子为2时，我们最多能够池化4次，超过4次时间信息会完全破坏掉了)。两个全连接层有2048个输出。我们使用30个片段mini-batches从头训练网络，学习率设置为0.003。没4轮学习率下降10倍。训练16轮停止。

改变网络结构：

出于研究的目的，我们把精力放在如何通过神经网络聚合时间信息。为了探索最佳3D卷积网络结构，我们只改变卷积层中卷积核的时间深度di，同时保持其他设置如上面所描述的。我们对两种结构类型进行实验：

1.相同的时间深度：所有卷积层有相同的核时间深度

我们实验了4种网络，核卷积深度分别为1，3，5，7，我们将这些网络表示为depth-d

2.改变的时间深度：所有卷积层的核时间深度是变化的

我们实验了两种网络，一种核卷积深度为增加 3-3-5-5-7，一种核卷积深度为减小 7-5-5-3-3

这些网络的输出信号有相同的尺寸，因此它们在全连接层的参数数量相同。它们的参数数量仅在卷积层有所不同，由于不同的核时间深度。这些差异比起全连接层的参数数量是相当小的。

3D卷积核参数的选择

![kernel](C:\Users\18292\Desktop\kernel.png)



实验表明，核卷积深度为3时性能最佳。depth-1性能明显低于其他网络。我们也实验了其他更大的空间感受野和更大的输入分辨率，得到同样的结论。3x3x3是最好的核选择。

C3D network结构

![c3d](C:\Users\18292\Desktop\c3d.png)

基于3D卷积操作，作者设计了如上所示的C3D network结构。共有8次卷积操作，4次池化操作。其中卷积核的大小均为3x3x3，步长为1x1x1。池化核的大小为2x2x2，步长为2x2x2，但第一层池化除外，其大小和步长均为1x2x2。这是为了不过早缩减时序上的长度。最终网络在经过两次全连接层和softmax层后就得到了最终的输出结果。网络的输入尺寸为3x16x112x112，即一次输入16帧图像。