# 上两周学习总结

* 毕设

  * system1
    * 初版代码已完成

      1. 按照设想，模型分为:

         BERT Encoder → Shema2Graph → Multi-Hop Reasoning → Output

      2. 在Multi-Hop Reasoning中，又包括4步：

         Soft mask between Schema and Question → Update column node representation → Update table node representation → Update Question   

      3. 需要预测的是：column和table

      这部分代码已经完成。

    * 训练部分

      遇到了一些困难。能进行table的预测，但是column的训练在epoch1就停滞不前，使得整个模型都没能训练成功。

      可能的原因有：

      1. GPU内存不够，导致batch size=2；多GPU训练还没有调通

      2. loss公式错误

         ```
          loss = tn_loss + t_loss + loss_coefficient*（cn_loss + c_loss）
          应该为：
          loss = loss_coefficient*（tn_loss + t_loss） + cn_loss + c_loss
         ```

      3. 根据dev column f1选择最佳模型，因为column训练失败，导致整个模型失败
      4. 代码未知错误

  * system2

    * 完成代码构思，正在写代码中

      1. 难点：树结构不固定

      ![屏幕快照 2020-01-11 上午9.49.59](https://i.imgur.com/790eT92.jpg)

      2. 方法：

         * 给出全部的路径

           ```
           {0: 'ROOT', 1: 'SELECT', 2: 'A', 3: 'A', 4: 'A', 5: 'A', 6: 'A', 7: 'A', 8: 'ORDER', 9: 'A', 10: 'LIMIT', 11: 'GROUP', 12: 'A', 13: 'A', 14: 'HAVING', 15: 'A', 16: 'OP', 17: 'WHERE', 18: 'A', 19: 'OP', 20: 'OP_Root', 21: 'RE', 22: 'A', 23: 'OP', 24: 'OP_Root', 25: 'RE', 26: 'A', 27: 'OP', 28: 'OP_Root', 29: 'Z'}
           ```

         * 给出树的拓扑结构

           ```
           {0: (None, None), 1: (0, None), 2: (1, None), 3: (1, 2), 4: (1, 3), 5: (1, 4), 6: (1, 5), 7: (1, 6), 8: (0, 1), 9: (8, None), 10: (8, 9), 11: (0, 8), 12: (11, None), 13: (11, 12), 14: (11, 12), 15: (14, None), 16: (14, 15), 17: (0, 11), 18: (17, None), 19: (18, None), 20: (19, None), 21: (17, 18), 22: (17, 21), 23: (22, 19), 24: (23, None), 25: (17, 22), 26: (17, 25), 27: (26, 23), 28: (27, None), 29: (None, 0)}
           ```

         * 在这个树上进行训练，每个node共享DRNN结构。

           ![屏幕快照 2020-01-11 上午9.52.43](https://i.imgur.com/Juc0FH8.jpg)

           想要传递的信息有3个部分：

           1. 父亲节点的隐藏层输出与type embedding
           2. 左兄弟节点的隐藏层输出与type embedding
           3. 自身的type embedding、context vector

         * 预测

           每个node是否存在，存在下再预测每个node的值

         * loss

           包括2部分：1. 树的拓扑结构；2. Value是否正确